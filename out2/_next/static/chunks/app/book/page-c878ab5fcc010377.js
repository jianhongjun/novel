(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[886],{1054:function(){},3493:function(e,t,a){Promise.resolve().then(a.bind(a,2862))},2862:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(9533),o=a(1229),s=a(1250),n=a(8197),c=a(5481),i=a(6289),l=a.n(i),u=a(2460),p=a.n(u);function d(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)().get("id"),[a,i]=(0,o.useState)(null),[u,d]=(0,o.useState)(!0),[g,h]=(0,o.useState)(null),[m,_]=(0,o.useState)(!1),f=(0,o.useRef)(null),y=()=>{m||(_(!0),setTimeout(()=>{try{let a=(0,c.n5)(),r="bookmarks_".concat(a,"_").concat(t),o=null,s=localStorage.getItem(r);if(s){let e=JSON.parse(s);if(e&&e.length>0){let t=e.sort((e,t)=>(t.timestamp||0)-(e.timestamp||0))[0];t&&t.chapterId&&(o=t.chapterId)}}o?e.push("/book/read?id=".concat(t,"&chapter=").concat(o)):e.push("/book/read?id=".concat(t))}catch(a){console.error("检查阅读记录失败:",a),e.push("/book/read?id=".concat(t))}},500))};return((0,o.useEffect)(()=>{let e=async()=>{try{d(!0),h(null);let e=await (0,c.mG)(t);i(e)}catch(e){console.error("获取书籍详情失败:",e),h(e instanceof Error?e.message:"获取书籍详情失败")}finally{d(!1)}};t&&e()},[t]),(0,o.useEffect)(()=>(a&&a.title?document.title="<<".concat(a.title,">>-微米小说"):document.title="微米小说",()=>{document.title="微米小说"}),[a]),(0,o.useEffect)(()=>{if(!f.current||!a)return;let e=0,t=0,r=0,o=t=>{e=t.touches[0].clientY,r=Date.now()},s=a=>{t=a.changedTouches[0].clientY;let o=e-t,s=Date.now()-r;o>50&&s<500&&!m&&y()},n=f.current;return n.addEventListener("touchstart",o,{passive:!0}),n.addEventListener("touchend",s,{passive:!0}),()=>{n.removeEventListener("touchstart",o),n.removeEventListener("touchend",s)}},[a,m,t,e]),u)?(0,r.jsx)("main",{className:l().pageBase2,children:(0,r.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"加载中..."})}):g||!a?(0,r.jsx)("main",{className:l().pageBase2,children:(0,r.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#f06e2b"},children:g||"书籍不存在"})}):(0,r.jsx)("main",{ref:f,className:"".concat(l().pageBase2," ").concat(m?p().pageSlideUp:""),style:{transition:"transform 0.5s ease-out"},children:(0,r.jsxs)("div",{className:p().container,children:[(0,r.jsxs)("header",{className:"".concat(p().header," ").concat(p().stickyHeader),children:[(0,r.jsx)("button",{className:l().backButtonBase,onClick:()=>e.push("/"),children:(0,r.jsx)(n.default,{src:"/fh@2x.png",alt:"返回",width:32,height:32,className:l().backIconBase,priority:!0,unoptimized:!0})}),(0,r.jsx)("button",{className:p().catalogButton,onClick:()=>e.push("/book/catalog?id=".concat(a.id)),children:"目录"})]}),(0,r.jsxs)("div",{className:p().scrollArea,children:[(0,r.jsx)("div",{className:p().bookCoverSection,children:(0,r.jsx)("div",{className:p().coverWrapper,children:(0,r.jsx)(n.default,{src:a.coverUrl,alt:a.title,width:128,height:176,className:p().bookCover,priority:!0,unoptimized:!0,onError:e=>{e.target.src="/2.png"}})})}),(0,r.jsxs)("div",{className:p().bookInfo,children:[(0,r.jsx)("div",{className:p().source,children:a.site}),(0,r.jsx)("h1",{className:p().bookTitle,children:a.title}),(0,r.jsxs)("div",{className:p().author,children:["作者: ",a.authorName]})]}),(0,r.jsx)("section",{className:p().synopsis,children:(0,r.jsxs)("div",{className:p().synopsisWrapper,children:[(0,r.jsx)("span",{className:p().synopsisTitle,children:"简介："}),(0,r.jsx)("span",{className:p().desc,children:a.intro})]})}),(0,r.jsx)("div",{className:p().readButtonWrapper,children:(0,r.jsxs)("button",{className:p().readButton,onClick:y,children:[(0,r.jsx)(n.default,{src:"/sh@2x.png",alt:"上滑",width:22,height:21,className:p().upIcon,unoptimized:!0}),(0,r.jsx)("span",{className:p().readButtonText,children:"上滑开始阅读"})]})})]})]})})}function g(){return(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)("div",{children:"Loading..."}),children:(0,r.jsx)(d,{})})}},5481:function(e,t,a){"use strict";a.d(t,{AT:function(){return l},Kr:function(){return g},V4:function(){return u},Z:function(){return d},mG:function(){return p},n5:function(){return c},sk:function(){return i}});var r=a(6161),o=a.n(r);let s="https://config.umeweb.cn";function n(e){let t=Object.keys(e).filter(e=>"sign"!==e).sort((e,t)=>e.localeCompare(t)).map(t=>"".concat(t).concat(e[t])).join(""),a="".concat("weimi_novel_key_20251223").concat(t).toLowerCase();return o().MD5(a).toString()}function c(){try{let e="novel_user_id",t=localStorage.getItem(e);if(!t){t=Date.now().toString(36)+Math.random().toString(36).substr(2,5);try{localStorage.setItem(e,t)}catch(e){console.warn("localStorage 不可用，使用临时用户 ID:",e)}}return t}catch(e){return console.warn("获取用户 ID 失败，使用临时 ID:",e),Date.now().toString(36)+Math.random().toString(36).substr(2,5)}}async function i(){try{var e;let t=c(),a=Date.now().toString(),r={uid:t,timestamp:a},o=n(r);r.sign=o,console.log("请求推荐小说，参数:",{uid:t,timestamp:a,sign:o.substring(0,8)+"..."});let i=await fetch("".concat(s,"/browser_business/novel/recommend"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(console.log("API 响应状态:",i.status,i.statusText),!i.ok){let e=await i.text();throw console.error("HTTP 错误响应:",e),Error("HTTP error! status: ".concat(i.status,", message: ").concat(e.substring(0,100)))}let l=await i.json();if(console.log("API 返回数据:",{code:l.code,hasResult:!!l.result,resultLength:null===(e=l.result)||void 0===e?void 0:e.length}),200!==l.code){let e=l.message||"获取推荐小说失败";throw console.error("API 返回错误:",e,l),Error(e)}let u=(l.result||[]).map((e,t)=>({id:e.cbid,title:e.title,author:e.author,status:e.status,cover:e.cover,freeType:e.freeType,category:e.category,recommend:e.recommend,bookshelf:e.bookshelf}));return console.log("成功获取小说列表，数量:",u.length),u}catch(e){if(console.error("获取推荐小说失败:",e),e instanceof TypeError&&e.message.includes("fetch"))throw Error("网络请求失败，请检查网络连接");if(e instanceof Error)throw e;throw Error("获取推荐小说失败，请稍后重试")}}async function l(){try{let e=Date.now().toString(),t=n({timestamp:e}),a=await fetch("".concat(s,"/browser_business/novel/category"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sign:t,timestamp:parseInt(e)})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let r=await a.json();if(200!==r.code)throw Error(r.message||"获取分类列表失败");let o=r.result||{},c=[];return o["1"]&&o["1"].length>0&&c.push({type:"男频",list:o["1"].map((e,t)=>({id:t+1,name:e.category,image:e.cover}))}),o["2"]&&o["2"].length>0&&c.push({type:"女频",list:o["2"].map((e,t)=>({id:t+1,name:e.category,image:e.cover}))}),o["3"]&&o["3"].length>0&&c.push({type:"出版物",list:o["3"].map((e,t)=>({id:t+1,name:e.category,image:e.cover}))}),c}catch(e){throw console.error("获取分类列表失败:",e),e}}async function u(e){try{let t=Date.now().toString(),a=e.pageNum||1,r=e.pageSize||20,o={timestamp:t,pageNum:a.toString(),pageSize:r.toString(),category:e.category,freeType:e.freeType.toString()},c=n(o),i=await fetch("".concat(s,"/browser_business/novel/category_list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sign:c,timestamp:parseInt(t),pageNum:a,pageSize:r,category:e.category,freeType:e.freeType})});if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));let l=await i.json();if(200!==l.code)throw Error(l.message||"获取分类列表失败");let u=l.result||{total:0,pages:0,data:[]};return{books:u.data.map(e=>({id:e.cbid,cbid:e.cbid,title:e.title,intro:e.intro||"",freeTypeName:e.freeTypeName||"",categoryName:e.categoryName||"",subCategoryName:e.subCategoryName||"",allWords:e.allWords||0,allChapter:e.allChapter||0,freeChapters:e.freeChapters||0,authorName:e.authorName||"",coverUrl:e.coverUrl||"",status:e.status||"连载",tags:e.tags||[],updateTime:e.updateTime||"",site:e.site||""})),total:u.total,pages:u.pages}}catch(e){throw console.error("获取分类列表失败:",e),e}}async function p(e){try{let t=Date.now().toString(),a=n({timestamp:t,cbid:e}),r=await fetch("".concat(s,"/browser_business/novel/info"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cbid:e,sign:a,timestamp:parseInt(t)})});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let o=await r.json();if(200!==o.code)throw Error(o.message||"获取书籍详情失败");let c=o.result||{};return{id:c.cbid,cbid:c.cbid,title:c.title||"",authorName:c.authorName||"",site:c.site?"来源".concat(c.site):"",coverUrl:c.coverUrl||"",intro:c.intro||"",status:c.status||"连载",freeTypeName:c.freeTypeName||"",categoryName:c.categoryName||"",subCategoryName:c.subCategoryName||"",allWords:c.allWords||0,allChapter:c.allChapter||0,freeChapters:c.freeChapters||0,tags:c.tags||[],updateTime:c.updateTime||""}}catch(e){throw console.error("获取书籍详情失败:",e),e}}async function d(e){try{let t=Date.now().toString(),a=e.pageNum||1,r=e.pageSize||20,o={timestamp:t,cbid:e.cbid,pageNum:a.toString(),pageSize:r.toString()},c=n(o),i=await fetch("".concat(s,"/browser_business/novel/chapter_list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cbid:e.cbid,pageNum:a,pageSize:r,sign:c,timestamp:parseInt(t)})});if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));let l=await i.json();if(200!==l.code)throw Error(l.message||"获取章节列表失败");return l.result||{totalCount:0,resultData:[],pages:0}}catch(e){throw console.error("获取章节列表失败:",e),e}}async function g(e){try{let t=Date.now().toString(),a=e.uid||c(),r={timestamp:t,cbid:e.cbid,uid:a,ccid:e.ccid},o=n(r),i=await fetch("".concat(s,"/browser_business/novel/chapter_content"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cbid:e.cbid,uid:a,ccid:e.ccid,sign:o,timestamp:parseInt(t)})});if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));let l=await i.json();if(200!==l.code)throw Error(l.message||"获取章节内容失败");return l.result||{}}catch(e){throw console.error("获取章节内容失败:",e),e}}},2460:function(e){e.exports={pageSlideUp:"page_pageSlideUp__5IS1U",container:"page_container__Ywl_x",stickyHeader:"page_stickyHeader__JfZQY",header:"page_header__1C_OG",scrollArea:"page_scrollArea__ZqW0t",catalogButton:"page_catalogButton__eJ6Kg",bookCoverSection:"page_bookCoverSection__eozbP",coverWrapper:"page_coverWrapper__waYJs",bookCover:"page_bookCover__JLTKy",bookInfo:"page_bookInfo__kQjsm",source:"page_source__KXO4I",bookTitle:"page_bookTitle__Xpe7_",author:"page_author__CO1Qh",synopsis:"page_synopsis__58yXH",synopsisWrapper:"page_synopsisWrapper__vArpK",synopsisWrapperFull:"page_synopsisWrapperFull__QQnkW",synopsisTitle:"page_synopsisTitle__0DF4k",desc:"page_desc__2dM4l",descFull:"page_descFull__5hHHe",moreButton:"page_moreButton__6uziK",readButtonWrapper:"page_readButtonWrapper__U2w4V",readButton:"page_readButton__K78j1",upIcon:"page_upIcon__Xz579",readButtonText:"page_readButtonText__eBFLl"}},6289:function(e){e.exports={pageBase:"common_pageBase__qitDy",pageBase2:"common_pageBase2__OVo5w",bannerBgBase:"common_bannerBgBase__X4J1N",bannerBlurBase:"common_bannerBlurBase__03GAE",bannerBlur2Base:"common_bannerBlur2Base__yimuN",headerBase:"common_headerBase__zHnZO",backButtonBase:"common_backButtonBase__pJynL",backIconBase:"common_backIconBase__LIW2m",headerWithBackBase:"common_headerWithBackBase__ZrM5F"}}},function(e){e.O(0,[541,264,197,170,842,744],function(){return e(e.s=3493)}),_N_E=e.O()}]);